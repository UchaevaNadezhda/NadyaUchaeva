= –ü–∞—Å–ø–æ—Ä—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ sme-gl-afaml-operations
:toc:
// –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –≤ —ç—Ç–æ–º –∑–∞–≥–æ–ª–æ–≤–∫–µ - —ç—Ç–æ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ –≤ –¢–ó
:jira_url: https://dit.rencredit.ru/jira/browse

// src_path - –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –¥—Ä—É–≥–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞–ª–µ–µ –±—É–¥—É—Ç –≤–∫–ª—é—á–∞—Ç—å—Å—è –≤ –¢–ó, —Å—Ö–µ–º–∞ plantuml, –∏ –ø—Ä–æ—á–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
:src_path: .

:doc_path: {src_path}/annex
:tip: üí°
// yaml_file - –∏–º—è —Ñ–∞–π–ª–∞ —Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º –ú–∫–° –≤ –∫–∞—Ç–∞–ª–æ–≥–µ src_path
:yaml_file: service-api.yaml

//common_errors_url - –∞–¥—Ä–µ—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ Confluence —Å –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∫–æ–¥–æ–≤ –æ—à–∏–±–æ–∫. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∞–ª–µ–µ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
:common_errors_url: https://dit.rencredit.ru/confluence/pages/viewpage.action?pageId=112132821

// adlayer-134_url - –∞–¥—Ä–µ—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å adlayer-134
:adlayer-134_url: https://dit.rencredit.ru/confluence/pages/viewpage.action?pageId=52396409

// adlayer-105_url - –∞–¥—Ä–µ—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å adlayer-105
:adlayer-105_url: https://dit.rencredit.ru/confluence/pages/viewpage.action?pageId=52986556

// sme-check-operation_url - –∞–¥—Ä–µ—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ –≤ Confluence
:sme-gl-afml-operations_url: https://dit.rencredit.ru/confluence/display/MIC/sme-gl-afaml-operations_1.0.0

// sme-check-operation_url - –∞–¥—Ä–µ—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ –≤ Confluence
:sme-check-operation_url: https://dit.rencredit.ru/confluence/display/MIC/sme-check-operation_1.2.0

// sme-info-operation_url - –∞–¥—Ä–µ—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ –≤ Confluence
:sme-info-operation_url: https://dit.rencredit.ru/confluence/display/MIC/sme-info-operation_1.2.0

// JIRA
:jira: https://dit.rencredit.ru/jira/browse/

// –°—Å—ã–ª–∫–∏ –Ω–∞ JSON —Å—Ö–µ–º—ã
:json_schemes: {src_path}/annex/json-schemas

.–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
[cols="1a,1a,2a,5a,2a,2a", options="header"]

|===
|–í–µ—Ä—Å–∏—è

–¥–æ–∫.|–í–µ—Ä—Å–∏—è

–ú–∫–° (–¥–æ–ª–∂–Ω–∞ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –≤–µ—Ä—Å–∏–µ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞!)|–î–∞—Ç–∞|–û–ø–∏—Å–∞–Ω–∏–µ| –ó–∞–¥–∞—á–∏ –≤ Jira | –ê–≤—Ç–æ—Ä

| 1
| 1.0.0
| 24.03.2023
|–ü–µ—Ä–≤–∏—á–Ω–∞—è –≤–µ—Ä—Å–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞:

. –û–ø–∏—Å–∞–Ω –º–µ—Ç–æ–¥ `sentPaymentForCheck` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –ë–î –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –≤—Ö–æ–¥—è—â–µ–≥–æ –ø–ª–∞—Ç–µ–∂–∞.

| {jira}BRF-25077[BRF-25077]

'''

Epic: {jira}INT-3255[INT-3255]

'''

–ó–∞–¥–∞—á–∞: {jira}INT-6988[INT-6988]

| mailto:ext_alezov2@rencredit.ru[–õ—ë–∑–æ–≤ –ê.–ü.]

| 1
| 1.0.0
| 14.04.2023
|–ü–µ—Ä–≤–∏—á–Ω–∞—è –≤–µ—Ä—Å–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞:

. –û–ø–∏—Å–∞–Ω –º–µ—Ç–æ–¥ `sentPaymentForInfo` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –ë–î –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ MQ —á–µ—Ä–µ–∑ –º–∫—Å. sme-info-operations info-—Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–º—É –≤—Ö–æ–¥—è—â–µ–º—É –ø–ª–∞—Ç–µ–∂—É.

| {jira}BRF-25077[BRF-25077]

'''

Epic: {jira}INT-3255[INT-3255]

'''

–ó–∞–¥–∞—á–∞: {jira}INT-7563[INT-7563]

| mailto:ext_alezov2@rencredit.ru[–õ—ë–∑–æ–≤ –ê.–ü.]

|===



== –û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è
.–û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–µ
[width= "80%", cols="1a,2a", options="header"]

|===

|–ü–∞—Ä–∞–º–µ—Ç—Ä |–û–ø–∏—Å–∞–Ω–∏–µ
|–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞	| sme-gl-afaml-operations
|–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞	| –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑ –ë–î Diasoft (GL) –≤—Ö–æ–¥—è—â–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –∏—Ö –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –≤ —Å–∏—Å—Ç–µ–º—É SAS (AF/AML) —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –ë–î.
|–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–∞–º–∏	| –º–∫—Å. sme-check-operations, –º–∫—Å. sme-info-operations
|–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º—ã	| Diasoft (GL, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã)
|–ü—Ä–æ—Ç–æ–∫–æ–ª –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö	| JDBC\HTTPS
|–¢–∏–ø —Å–µ—Ä–≤–∏—Å–∞	|  –∞–¥–∞–ø—Ç–µ—Ä –∫ –ë–î
|–ö–æ–¥–∏—Ä–æ–≤–∫–∞	| UTF-8
|–°—Ç–∞—Ç—É—Å	|
* [x] –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
* [ ] –ù–∞ —Å—Ä–µ–¥–µ TEST
* [ ] –ù–∞ —Å—Ä–µ–¥–µ PREPROD
* [ ] –ù–∞ —Å—Ä–µ–¥–µ PROD
* [ ] –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
|===

== –ö–æ–Ω—Ç—Ä–∞–∫—Ç
link:{src_path}/{yaml_file}[{yaml_file}]


== –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ú–∫–° –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π:

* –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –ë–î —Å–ø–∏—Å–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏—Ö –≤ –º–∫—Å. sme-check-operations –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ SAS (check). –ó–∞–ø–∏—Å—å –≤ –ë–î —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ SAS.
* –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –ë–î —Å–ø–∏—Å–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏—Ö –≤ –º–∫—Å. sme-info-operations –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è SAS –æ–± –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ (info). 

== –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ —Å–µ—Ä–≤–∏—Å–∞
=== [[SM_01]]SM_01. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π, –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏—Ö –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –≤ SAS –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –ø—Ä–æ–≤–µ—Ä–∫–∏.
*–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞*:  sentPaymentForCheck +
*–ü—É—Ç—å –º–µ—Ç–æ–¥–∞*: –Ω–µ—Ç +
*–¢–∏–ø –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è*: —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, +
*–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏*: SELECT\UPDATE +
*–¢–∏–ø –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è*: –Ω–µ—Ç +
*–¢–∏–ø –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è*: http –æ—Ç–≤–µ—Ç, Content-Type: application/json +
*–í–ª–∏—è–Ω–∏–µ –Ω–∞ –≥—Ä—É–ø–ø—ã –ø—Ä–æ–¥—É–∫—Ç–æ–≤*: –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ +
*–û–ø–∏—Å–∞–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π MQ*:  +
*–ò–º—è —Ä–µ—Å—É—Ä—Å–∞*:

==== –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞
–ú–µ—Ç–æ–¥ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑ –ë–î Diasoft –≤—Ö–æ–¥—è—â–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ JDBC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –æ—Ç–ø—Ä–∞–≤–∫—É –∏—Ö –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –≤ SAS (AF –∏ AML) —á–µ—Ä–µ–∑ –º–∫—Å. sme-check-operations, –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ JDBC –≤ –ë–î —Å—Ç–∞—Ç—É—Å–∞ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –ø—Ä–æ–≤–µ—Ä–∫–∏.

=== –î–∏–∞–≥—Ä–∞–º–º–∞ —Ä–∞–±–æ—Ç—ã –º–µ—Ç–æ–¥–∞
image::./annex/diagrams/SM_01.puml[]
(–°–º _annex/diagrams/SM_01.puml_ –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏). 

==== –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã –º–µ—Ç–æ–¥–∞
. –ó–∞–ø—É—Å–∫ –º–µ—Ç–æ–¥–∞ sentPaymentForCheck —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é —Å –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å—é <<config-params, RunPeriod>>. 
. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∫ –ë–î (MS SQL). –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —É–∫–∞–∑–∞–Ω—ã –≤ <<sreda, —Ç–∞–±–ª. –°—Ä–µ–¥—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è>>. 
.. –ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –æ—Ç–∫—Ä—ã—Ç—å –Ω–µ —É–¥–∞–ª–æ—Å—å, —Ç–æ –≤ –ª–æ–≥ –ø–∏—à–µ—Ç—Å—è {common_errors_url}[EC-Exception]. –°—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.
. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è SELECT-–∑–∞–ø—Ä–æ—Å —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ <<config-params, NumberOfStrings>> —Å–æ —Å–ª–µ–¥—É—é—â–µ–π –≤—ã–±–æ—Ä–∫–æ–π:
[%collapsible]
====
[source,sql]
----
SELECT ID, DOCNUMBER, BATCH, DOCDATE, OPCODE, PAYMENTPURPOSE, CURRENCYDEB, CURRENCYCRE, AMOUNTDEB, AMOUNTCRE, AMOUNTRUB, TYPE, USERLOGINOPEN, DEALTRANSACTID, GLOBALID, PAYERBANKBIC, PAYERBANKCORRACCOUNT, PAYERACCOUNT, PAYERINN, PAYERNAME, PAYEECIFID, PAYEEACCOUNT, PAYEEINN, SYSTEMNAME, MSGTS, FLOWTYPE, MSGTYPE, RESPONSECODE, STATUSCODE, STATUSCHANGETIME, ORIGTS
FROM SME_AFAML_DocAttr_Inbox
WHERE RESPONSECODE IS NULL OR RESPONSECODE = ''?
ORDER BY ID ASC
OFFSET 0 ROWS FETCH NEXT 'NumberOfStrings' ROWS ONLY
----
====

.. –ï—Å–ª–∏ SELECT-–∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ —É–¥–∞–ª–æ—Å—å –∏–ª–∏ SELECT-–∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —Å –æ—à–∏–±–∫–æ–π, —Ç–æ –≤ –ª–æ–≥ –ø–∏—à–µ—Ç—Å—è {common_errors_url}[EC-Exception]. –°—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.
.. –ï—Å–ª–∏ SELECT-–∑–∞–ø—Ä–æ—Å –ø—É—Å—Ç–æ–π, —Ç–æ –≤ –ª–æ–≥ –ø–∏—à–µ—Ç—Å—è HTTP Status 204 No Content. –°—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.
.. –ï—Å–ª–∏ SELECT-–∑–∞–ø—Ä–æ—Å –Ω–µ –ø—É—Å—Ç–æ–π, —Ç–æ:
... –ü–æ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ –∏–∑ SELECT-–∑–∞–ø—Ä–æ—Å–∞ –≤ —Ü–∏–∫–ª–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π:
.... –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ <<SM_01_T_01, SM_01_T_01>>.
.... –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥ POST SMEIncomingPayment –º–∫—Å. link:{src_path}/{sme-check-operation_url}[sme-check-operations].
..... –ï—Å–ª–∏ –≤ –æ—Ç–≤–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è HTTP Status 400 –∏–ª–∏ 500, —Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ <<SM_01_T_03, SM_01_T_03>>.
..... –ï—Å–ª–∏ –≤ –æ—Ç–≤–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è HTTP Status 200, —Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ <<SM_01_T_02, SM_01_T_02>>.
.... –ü–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å UPDATE:
[%collapsible]
====
[source,sql]
----
UPDATE SME_AFAML_DocAttr_Inbox SET RESPONSECODE = {responseCode}, EXTCOMMENT = {extComment}, INTCOMMENT = {intComment}, PROCESSTS = {Server date-time}
WHERE ID = {ID}
----
====

..... –ï—Å–ª–∏ UPDATE-–∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ —É–¥–∞–ª–æ—Å—å –∏–ª–∏ UPDATE-–∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —Å –æ—à–∏–±–∫–æ–π, —Ç–æ –≤ –ª–æ–≥ –ø–∏—à–µ—Ç—Å—è {common_errors_url}[EC-Exception]. –°—Ü–µ–Ω–∞—Ä–∏–π –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥.
..... –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ SELECT –Ω–µ –ø–æ—Å–ª–µ–¥–Ω—è—è, —Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ SELECT –ø–æ–∫–∞ UPDATE –Ω–µ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏.
. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å –ë–î –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è. –í –ª–æ–≥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—Ç–≤–µ—Ç HTTP Status 200. –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.

=== [[SM_02]]SM_02. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ –Ω–∏–º –≤ SAS info-—Å–æ–æ–±—â–µ–Ω–∏—è –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –ë–î –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ info-—Å–æ–æ–±—â–µ–Ω–∏—è.
*–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞*:  sentPaymentForInfo +
*–ü—É—Ç—å –º–µ—Ç–æ–¥–∞*: –Ω–µ—Ç +
*–¢–∏–ø –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è*: —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, +
*–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏*: SELECT\UPDATE +
*–¢–∏–ø –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è*: –Ω–µ—Ç +
*–¢–∏–ø –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è*: http –æ—Ç–≤–µ—Ç, Content-Type: application/json +
*–í–ª–∏—è–Ω–∏–µ –Ω–∞ –≥—Ä—É–ø–ø—ã –ø—Ä–æ–¥—É–∫—Ç–æ–≤*: –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ +
*–û–ø–∏—Å–∞–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π MQ*:  +
*–ò–º—è —Ä–µ—Å—É—Ä—Å–∞*:

==== –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞
–ú–µ—Ç–æ–¥ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑ –ë–î Diasoft –≤—Ö–æ–¥—è—â–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ JDBC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫—É –ø–æ –Ω–∏–º info-—Å–æ–æ–±—â–µ–Ω–∏—è –≤ SAS (AF –∏ AML) —á–µ—Ä–µ–∑ –º–∫—Å. sme-info-operations, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ JDBC –≤ –ë–î –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ.

=== –î–∏–∞–≥—Ä–∞–º–º–∞ —Ä–∞–±–æ—Ç—ã –º–µ—Ç–æ–¥–∞
image::./annex/diagrams/SM_02.puml[]
(–°–º _annex/diagrams/SM_02.puml_ –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏). 

==== –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã –º–µ—Ç–æ–¥–∞
. –ó–∞–ø—É—Å–∫ –º–µ—Ç–æ–¥–∞ sentPaymentForInfo —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é —Å –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å—é <<config-params, RunPeriod>>. 
. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∫ –ë–î (MS SQL). –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —É–∫–∞–∑–∞–Ω—ã –≤ <<sreda, —Ç–∞–±–ª. –°—Ä–µ–¥—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è>>. 
.. –ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –æ—Ç–∫—Ä—ã—Ç—å –Ω–µ —É–¥–∞–ª–æ—Å—å, —Ç–æ –≤ –ª–æ–≥ –ø–∏—à–µ—Ç—Å—è {common_errors_url}[EC-Exception]. –°—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.
. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è SELECT-–∑–∞–ø—Ä–æ—Å —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ <<config-params, NumberOfStrings>> —Å–æ —Å–ª–µ–¥—É—é—â–µ–π –≤—ã–±–æ—Ä–∫–æ–π:
[%collapsible]
====
[source,sql]
----
SELECT ID, DOCNUMBER, BATCH, DOCDATE, OPCODE, PAYMENTPURPOSE, CURRENCYDEB, CURRENCYCRE, AMOUNTDEB, AMOUNTCRE, AMOUNTRUB, TYPE, USERLOGINOPEN, DEALTRANSACTID, GLOBALID, PAYERBANKBIC, PAYERBANKCORRACCOUNT, PAYERACCOUNT, PAYERINN, PAYERNAME, PAYEECIFID, PAYEEACCOUNT, PAYEEINN, SYSTEMNAME, MSGTS, FLOWTYPE, MSGTYPE, RESPONSECODE, STATUSCODE, STATUSCHANGETIME, ORIGTS, WAITFLAG, PROCESSTS
FROM SME_AFAML_DocAttr_Inbox
WHERE FLOWTYPE = 'info' AND WAITFLAG = '1' OR WAITFLAG IS NULL OR WAITFLAG = ''?
ORDER BY ID ASC
OFFSET 0 ROWS FETCH NEXT 'NumberOfStrings' ROWS ONLY
----
====

.. –ï—Å–ª–∏ SELECT-–∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ —É–¥–∞–ª–æ—Å—å –∏–ª–∏ SELECT-–∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —Å –æ—à–∏–±–∫–æ–π, —Ç–æ –≤ –ª–æ–≥ –ø–∏—à–µ—Ç—Å—è {common_errors_url}[EC-Exception]. –°—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.
.. –ï—Å–ª–∏ SELECT-–∑–∞–ø—Ä–æ—Å –ø—É—Å—Ç–æ–π, —Ç–æ –≤ –ª–æ–≥ –ø–∏—à–µ—Ç—Å—è HTTP Status 204 No Content. –°—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.
.. –ï—Å–ª–∏ SELECT-–∑–∞–ø—Ä–æ—Å –Ω–µ –ø—É—Å—Ç–æ–π, —Ç–æ:
... –ü–æ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ –∏–∑ SELECT-–∑–∞–ø—Ä–æ—Å–∞ –≤ —Ü–∏–∫–ª–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π:
.... –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ <<SM_02_T_01, SM_02_T_01>>.
.... –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥ POST infoSMEPaymentTransfer –º–∫—Å. link:{src_path}/{sme-info-operation_url}[sme-info-operation].
..... –ï—Å–ª–∏ –≤ –æ—Ç–≤–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è HTTP Status 400 –∏–ª–∏ 500, —Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è UPDATE1:
[%collapsible]
====
[source,sql]
----
UPDATE SME_AFAML_DocAttr_Inbox SET WAITFLAG = '8'
WHERE ID = {ID}
----
====
..... –ï—Å–ª–∏ –≤ –æ—Ç–≤–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è HTTP Status 200, —Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è UPDATE2: 
[%collapsible]
====
[source,sql]
----
UPDATE SME_AFAML_DocAttr_Inbox SET WAITFLAG = '9'
WHERE ID = {ID}
----
====
..... –ï—Å–ª–∏ UPDATE-–∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ —É–¥–∞–ª–æ—Å—å –∏–ª–∏ UPDATE-–∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —Å –æ—à–∏–±–∫–æ–π, —Ç–æ –≤ –ª–æ–≥ –ø–∏—à–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "UPDATE –ø–æ –∑–∞–ø–∏—Å–∏ {ID} –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ —É–¥–∞–ª–æ—Å—å. –°—Ü–µ–Ω–∞—Ä–∏–π –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥.
..... –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ SELECT –Ω–µ –ø–æ—Å–ª–µ–¥–Ω—è—è, —Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ SELECT –ø–æ–∫–∞ UPDATE –Ω–µ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏.
. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å –ë–î –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è. –í –ª–æ–≥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—Ç–≤–µ—Ç HTTP Status 200. –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.


== –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
[[config-params]]
|===
|–ö–æ–¥	|–ó–Ω–∞—á–µ–Ω–∏–µ	|–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

|RunPeriod	|30 —Å–µ–∫.	|–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ –º–µ—Ç–æ–¥–∞ sentPaymentForCheck
|NumberOfStrings	|250	|–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–∞–ø—Ä–æ—Å–æ–º SELECT –º–µ—Ç–æ–¥–∞ sentPaymentForCheck
|===

== –°—Ä–µ–¥—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
[[sreda]]
|===
|–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å—Ä–µ–¥—ã	|–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è	|–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

|DEV	|–°–µ—Ä–≤–µ—Ä –ë–î: SRVTST8141\diasoftglDEV –ê–ª–∏–∞—Å: DiasoftGLdev URL: jdbc:jtds:sqlserver://SRVTST8141:1433/DiasoftGLDev –£–ó: svc_sme_sasmcs –ø–∞—Ä–æ–ª—å: rPBHaaVNJ8BETaF4dE0n	|DEV-—Å—Ä–µ–¥–∞
|TEST	|–°–µ—Ä–≤–µ—Ä –ë–î: SRVTST14725\DiasoftGLtest –ê–ª–∏–∞—Å: DiasoftGLtest URL: jdbc:jtds:sqlserver://diasoftGLtest.rccf.ru:1433/DiasoftGLtest –£–ó: svc_sme_sasmcs –ø–∞—Ä–æ–ª—å: rPBHaaVNJ8BETaF4dE0n	|TEST-—Å—Ä–µ–¥–∞
|PREPROD-FT	|	|PREPROD-FT-—Å—Ä–µ–¥–∞
|PREPROD-NT	|	|PREPROD-NT-—Å—Ä–µ–¥–∞
|PROD	|	|PROD-—Å—Ä–µ–¥–∞

|===

== –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
[[SM_01_T_01]]
=== SM_01_T_01 - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ –º–µ—Ç–æ–¥—É SMEIncomingPayment –º–∫—Å. sme-check-operations –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ SELECT-–∑–∞–ø—Ä–æ—Å–∞.
.–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è 1
[%collapsible]
====
include::{src_path}/annex/transformation_tables/SM_01_T_01.adoc[]
====

[[SM_01_T_02]]
=== SM_01_T_02 - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç  –º–µ—Ç–æ–¥–∞ SMEIncomingPayment –º–∫—Å. sme-check-operations –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è UPDATE-–∑–∞–ø—Ä–æ—Å–∞.
.–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è 2
[%collapsible]
====
include::{src_path}/annex/transformation_tables/SM_01_T_02.adoc[]
====

[[SM_01_T_03]]
=== SM_01_T_03 - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç  –º–µ—Ç–æ–¥–∞ SMEIncomingPayment –º–∫—Å. sme-check-operations –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∏\–∏–ª–∏ —Ç–∞–π–º–∞—É—Ç–µ –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è UPDATE-–∑–∞–ø—Ä–æ—Å–∞.
.–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è 3
[%collapsible]
====
include::{src_path}/annex/transformation_tables/SM_01_T_03.adoc[]
====

[[SM_02_T_01]]
=== SM_02_T_01 - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π –∑–∞–ø—Ä–æ—Å–∞ SELECT –¥–ª—è –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–∞ infoSMEPaymentTransfer –º–∫—Å. sme-info-operation.
.–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è 4
[%collapsible]
====
include::{src_path}/annex/transformation_tables/SM_02_T_01.adoc[]
====

== –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
=== –ü—Ä–æ—Ç–æ–∫–æ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞ –¥–æ–ª–∂–Ω—ã –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è.
.. –°–ø–æ—Å–æ–± –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: {adlayer-105_url}[—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º]

=== –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
|===
h|–ü–∞—Ä–∞–º–µ—Ç—Ä	h|–ó–Ω–∞—á–µ–Ω–∏–µ

|–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å	|
|–ü–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞|
|–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞	|
|===

=== –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
. –í—Ä–µ–º—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏: 24x7*365

=== –ö–ª–∞—Å—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
|===
|–ö–ª–∞—Å—Å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏	|–ö–ª–∞—Å—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è |RTO |RPO

| Mission Critical|1 –∫–ª–∞—Å—Å |4 —á–∞—Å–∞ |1,5 —á–∞—Å–∞
|===

